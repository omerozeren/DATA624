---
title: "DATA 624 - Homework 10"
author: "OMER OZEREN"
output:
  html_document:
    highlight: tango
    theme: journal
    toc: yes
    toc_depth: 5
    toc_float: yes
always_allow_html: yes
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(kableExtra)
library(tidyr)
library(arules)
library(stats)
```

## Introduction


Imagine 10000 receipts sitting on your table. Each receipt represents a transaction with items that were purchased. The receipt is a representation of stuff that went into a customer's basket - and therefore 'Market Basket Analysis'.

That is exactly what the Groceries Data Set contains: a collection of receipts with each line representing 1 receipt and the items purchased. Each line is called a transaction and each column in a row represents an item.  The data set is attached.

Your assignment is to use R to mine the data for association rules. You should report support, confidence and lift and your top 10 rules by lift. 

Extra credit: do a simple cluster analysis on the data as well.  Use whichever packages you like. 

## Import Data / Plot Features

I'll use itemFrequencyPlot for plotting top to features.I found the documentation from https://www.rdocumentation.org/packages/arules/versions/1.5-5/topics/itemFrequencyPlot.

```{r}
#data <- read.csv("https://raw.githubusercontent.com/omerozeren/DATA624/master/HMW10/GroceryDataSet.csv")
#itemFrequencyPlot(data, topN=10, type="absolute", main="The top 10 features",col="#f2fbd2")
data <- read.transactions("GroceryDataSet.csv", sep=",")
itemFrequencyPlot(data, topN=10, type="absolute", main="The top 10 features",col="#f2fbd2")
```

The graph above indicates that the most important feature is WholeMilk and other vegetables follows it

## Apriori Algorithm - Top 10 Rules

For Market Analyisis , I'll implement Apriori algorithm. Mine frequent itemsets, association rules or association hyperedges using the Apriori algorithm. The Apriori algorithm employs level-wise search for frequent itemsets. 
Ref : https://www.rdocumentation.org/packages/arules/versions/1.6-6/topics/apriori

```{r}
top_10_rules<- apriori(data, parameter=list(supp=0.001, conf=0.5) , control=list(verbose=FALSE))
  
  top_10_rules %>% 
  DATAFRAME() %>%
  arrange(desc(lift)) %>%
  top_n(10) %>%
  kable() %>%
  kable_styling()
```


## Cluster Analysis

The basic Clustering graph is generated by using "hclust" from https://www.r-graph-gallery.com/29-basic-dendrogram.html. The graph below alligns with the Top 10 Associative Rules above which indicates Wholemilk and pther vegitables are most important cluster features.

```{r}
dataframe <- read.transactions("GroceryDataSet.csv", sep=",")
                      
dataframe <- dataframe[ , itemFrequency(dataframe) > 0.05]
d_jaccard <- dissimilarity(dataframe, which = "items")
# plot dendrogram
plot(hclust(d_jaccard, method = "ward.D2"), 
     main = "Features Clustering", sub = "", xlab = "")
```